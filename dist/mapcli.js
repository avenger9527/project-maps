var e=require("cac"),t=require("fs/promises"),s=require("path"),r=require("filesize");function c(e){return e&&e.__esModule?e.default:e}var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},o={},n=a.parcelRequire0bdd;null==n&&((n=function(e){if(e in i)return i[e].exports;if(e in o){var t=o[e];delete o[e];var s={id:e,exports:{}};return i[e]=s,t.call(s.exports,s,s.exports),s.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){o[e]=t},a.parcelRequire0bdd=n);const l={exclude:["node_modules"],relativepathDesc:{".git":{desc:"git workspace",collapsed:!0},".husky":{desc:"husky workspace",collapsed:!0},".vscode":{desc:"vscode config",collapsed:!0},dist:{desc:"",collapsed:!0},"yarn.lock":{desc:"yarn package lock file",collapsed:!0}}},p=async e=>{const r=d(),a=r?{exclude:[...new Set(r.exclude.concat(l.exclude))],relativepathDesc:[...new Set([...Object.keys(l.relativepathDesc),...Object.keys(r.relativepathDesc)])].reduce(((e,t)=>{var s,c;return e[t]=Object.assign({},null!==(s=r.relativepathDesc[t])&&void 0!==s?s:{},null!==(c=l.relativepathDesc[t])&&void 0!==c?c:{}),e}),{})}:l;try{await c(t).writeFile(c(s).resolve(e,"projectMaps.config.js"),"module.exports = "+JSON.stringify(a,null,2)),console.log("write-projectMaps.config.js-success")}catch(e){console.error("write-projectMaps.config.js-error",e)}};const d=()=>{try{return require(c(s).resolve(process.cwd(),"projectMaps.config.js"))}catch(e){return console.error("getUserConfig-error,use default config"),l}},u=async(e,a,i,o,n)=>{let l=await c(t).readdir(c(s).resolve(e));l=l.filter((e=>!a.exclude.includes(e))),await Promise.all(l.map((async l=>{var p,d;const h=c(s).resolve(e,l),v=c(s).relative(process.cwd(),h);var w;const g=null!==(w=null===(p=a.relativepathDesc[v])||void 0===p?void 0:p.desc)&&void 0!==w?w:"",m=!(n<=2);var y;const f=null!==(y=null===(d=a.relativepathDesc[v])||void 0===d?void 0:d.collapsed)&&void 0!==y?y:m,j=await c(t).stat(h),b=j.isDirectory();var x;o[l]=function(e,t,s,r,c,a,i){const o={parentName:e,fullPath:t,relativePath:s,size:r,desc:c,collapsed:i};return a&&(o.children={}),o}(i,h,v,c(r)(j.size),g,b,f),b&&await u(h,a,l,null!==(x=o[l].children)&&void 0!==x?x:{},n+1)})))},h=async e=>{const r=`\n  <!DOCTYPE html>\n  <html lang="en">\n    <head>\n      <meta charset="UTF-8" />\n      <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n      <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n      <title>Project-Maps</title>\n      <style>\n        * {\n          padding: 0;\n          margin: 0;\n        }\n      </style>\n    </head>\n    <body>\n      <div style="width: 100vw; height: 100vh; display: flex">\n        <div id="container" style="flex: 1"></div>\n      </div>\n      <script>\n      ${await(async e=>{const t={},s=d();try{return await u(e,s,"root",t,1),"window.projectMapsTree = "+JSON.stringify(t,null,2)}catch(e){console.log("write-projectMaps.tree.js-error",e)}})(e)}\n      <\/script>\n      <script src="./${c(s).relative(process.cwd(),__filename.replace(/mapcli\.js/g,"chart.js"))}"><\/script>\n    </body>\n  </html>\n\n  `;try{await c(t).writeFile(c(s).resolve(e,"projectMaps.views.html"),r),console.log("write-projectMaps.views.html.js-success")}catch(e){console.error("write-projectMaps.views.html.js-error",e)}},v=e.cac("project-maps");v.command("init").action((async()=>{try{await p(process.cwd())}catch(e){process.exit(1)}})),v.command("generate").action((async()=>{try{await h(process.cwd())}catch(e){process.exit(1)}})),v.command("flow").action((async()=>{const e=process.cwd();try{await p(e),await h(e)}catch(e){process.exit(1)}})),v.help(),n.register("4pejK",(function(e,t){e.exports=JSON.parse('{"name":"project-maps","version":"1.0.6","description":"visualize your project","bin":{"project-maps":"./bin/project-maps.js"},"files":["dist/"],"engines":{"node":">= 12"},"mapcli":"dist/mapcli.js","chart":"dist/chart.js","targets":{"mapcli":{"sourceMap":false,"source":"src/main.ts","engines":{"node":">= 12"}},"chart":{"sourceMap":false,"source":"src/chart.ts","engines":{"browsers":"> 0.5%, last 2 versions, not dead"}}},"scripts":{"build":"parcel build --no-cache","build:mapcli":"parcel build --target mapcli --no-cache","build:chart":"parcel build --target chart --no-cache","watch":"parcel watch"},"repository":{"type":"git","url":"https://github.com/toSayNothing/project-maps.git"},"keywords":["visualize","project","maps"],"author":"toSayNothing","license":"MIT","bugs":{"url":"https://github.com/toSayNothing/project-maps/issues"},"homepage":"https://github.com/toSayNothing/project-maps#readme","devDependencies":{"@parcel/packager-ts":"^2.0.1","@parcel/transformer-typescript-types":"^2.0.1","@types/node":"^17.0.4","parcel":"^2.0.1","typescript":">=3.0.0"},"dependencies":{"cac":"^6.7.12","echarts":"^5.2.2","filesize":"^8.0.6","vscode-icons-js":"^11.6.1"}}')})),v.version(n("4pejK").version),v.parse();